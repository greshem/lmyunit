//--------------------------------------------------------------------------------------------------------------------------------
//                  ;;;,
//        ,;;;;;: ,;;;:.,;..
//         :;;"`,;;;;;;"":;;					单元名称：LZW压缩处理
//      ..;;:  .;;,.;;:',;;"
//    ,;;;;;;" :;`',;",;;"						编写日期：2004年5月20
//   :" ,;:` , `:.;;;;;'
//    ,;;;,;:;;,;;;, ,;							编写人员：richtech
//   :;;;"` `:;;;;;,;,.;.
//   '""   .;;`.;";:;;;;` ;,					备注信息：
//       .;"`  ::. '   .,;;;
//      ""     ';;;;;;;;;;`
//--------------------------------------------------------------------------------------------------------------------------------
#ifndef __LmyUnitMLZW4096H__
#define __LmyUnitMLZW4096H__
//--------------------------------------------------------------------------------------------------------------------------------
//公共头文件
#include "mobject.h"
//................................................................................................................................
#ifdef WINDOWSCODE
//................................................................................................................................
//Windows操作系统
//................................................................................................................................
#else
//................................................................................................................................
//Linux操作系统
//................................................................................................................................
#endif
//--------------------------------------------------------------------------------------------------------------------------------
#pragma pack(1)
//--------------------------------------------------------------------------------------------------------------------------------
#define MLZW4096_BITS							12
#define MLZW4096_MAXCODE						((1 << MLZW4096_BITS) - 1)
#define MLZW4096_TABLESIZE						5021
#define MLZW4096_END							256
#define MLZW4096_BUMPCODE						257
#define MLZW4096_FIRSTCODE						258
#define MLZW4096_UNUSER							-1
//................................................................................................................................
typedef struct
{
	short									CodeValue;
	short									ParentCode;
	char									Character;
} tagLzwDirectInfo;
//--------------------------------------------------------------------------------------------------------------------------------
#pragma pack()
//--------------------------------------------------------------------------------------------------------------------------------
#define		ERROR_MLZW4096_INSIDEPARAM		(ERROR_USER(130))		//MLZW压缩数据发生错误[内部参数错误]
//................................................................................................................................
class MLZW4096 : public MObject
{
private:
	tagLzwDirectInfo						m_Dictory[MLZW4096_TABLESIZE];
	char									m_StackBuf[MLZW4096_TABLESIZE];
private:
	__inline int  PutBitToBuf(char * InBuf,unsigned short InSize,unsigned long BitOffset,unsigned long Value,unsigned long BitSize);
	__inline int  GetBitFromBuf(char * InBuf,unsigned short InSize,unsigned long BitOffset,unsigned long * Value,unsigned long BitSize);
private:
	__inline void Initialize(void);
	__inline unsigned long FindChildNode(long ParentCode,long ChildCode);
	__inline unsigned long DecodeString(unsigned long Count,unsigned long Code);
public:
	MLZW4096(void);
	~MLZW4096();
public:
	virtual int  CompressBuf(char * InBuf,unsigned short InSize,char * OutBuf,unsigned short OutSize);
	virtual int  ExpandBuf(char * InBuf,unsigned short InSize,char * OutBuf,unsigned short OutSize);

	DECLARE_LMYUNIT(MLZW4096)
};
//--------------------------------------------------------------------------------------------------------------------------------
#endif
//--------------------------------------------------------------------------------------------------------------------------------
